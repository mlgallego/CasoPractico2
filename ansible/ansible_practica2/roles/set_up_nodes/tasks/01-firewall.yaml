- name: Enable firewall
  systemd:
   name: firewalld
   state: started
   enabled: yes

- name: Enable br_netfilter module
  modprobe:
    name: br_netfilter
    state: present

- name: activate transparent masquerading
  shell: |
    firewall-cmd --add-masquerade --permanent

- name: SDN firewall configuration 
  firewalld:
    port: "{{ item }}"
    permanent: true
    state: enabled
  with_items: #looping
     - 8472/udp
     - 8285/udp

- name: reload firewalld
  systemd: 
    name: firewalld
    state: reloaded

- name: Create k8s file
  copy: 
    dest: "/etc/sysctl.d/k8s.conf"
    content: |
      net.bridge.bridge-nf-call-ip6tables = 1
      net.bridge.bridge-nf-call-iptables = 1

- name: set the firewall traffic reading values from all system directories
  shell: |
         sysctl --system
